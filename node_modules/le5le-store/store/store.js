"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var data_1 = require("./data");
var observer_1 = require("./observer");
var uuid_1 = require("./uuid");
var Store = /** @class */ (function () {
    function Store() {
    }
    Store.get = function (key) {
        if (!key && key === undefined) {
            return data_1.data;
        }
        var props = key.split('.');
        var val = data_1.data;
        for (var _i = 0, props_1 = props; _i < props_1.length; _i++) {
            var prop = props_1[_i];
            val = val[prop];
            if (val === undefined) {
                return undefined;
            }
        }
        return val;
    };
    Store.set = function (key, value) {
        var props = key.split('.');
        var val = data_1.data;
        for (var i = 0; i < props.length - 1; ++i) {
            if (!val[props[i]]) {
                val[props[i]] = {};
            }
            val = val[props[i]];
        }
        val[props[props.length - 1]] = value;
        // tslint:disable-next-line:forin
        for (var id in data_1.observers) {
            if (key === data_1.observers[id].key) {
                data_1.observers[id].fn(value);
            }
            else if (key.indexOf(data_1.observers[id].key) === 0) {
                data_1.observers[id].fn(Store.get(data_1.observers[id].key));
            }
        }
    };
    Store.updated = function (key) {
        for (var id in data_1.observers) {
            if (key.indexOf(data_1.observers[id].key) === 0) {
                data_1.observers[id].fn(Store.get(data_1.observers[id].key));
            }
        }
    };
    Store.subscribe = function (key, fn) {
        var id = uuid_1.s8();
        var observer = new observer_1.Observer(id, key, fn);
        data_1.observers[id] = observer;
        var value = Store.get(key);
        if (value !== undefined && value !== null) {
            fn(value);
        }
        return observer;
    };
    return Store;
}());
exports.Store = Store;
//# sourceMappingURL=store.js.map